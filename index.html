<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>근무현황표 생성기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            background-color: #f4f4f4;
            color: #333;
        }

        .controls {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .controls label {
            font-weight: bold;
            margin-right: 5px;
        }
        .controls input[type="number"],
        .controls select {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 70px;
            box-sizing: border-box;
        }
        .controls input[type="radio"] {
            margin-left: 10px;
        }
        .controls button, .controls a.button-link {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px;
            margin-right: 8px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            white-space: nowrap;
        }
        .controls button:hover, .controls a.button-link:hover {
            background-color: #0056b3;
        }

        #scheduleContainer {
            background-color: white;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 95%;
            overflow-x: auto;
        }
        table {
            width: 100%;
            min-width: 700px;
            border-collapse: collapse;
            margin: 0 auto;
            font-size: 0.9em;
            background-color: #fff;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: center;
            vertical-align: top;
            line-height: 1.1;
            word-break: keep-all;
            height: 38px;
            box-sizing: border-box;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        caption {
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
            text-decoration: underline;
        }
        .sunday { background-color: #ffe0e0; }
        .saturday { background-color: #e0e0ff; }
        .holiday { background-color: #ffcccc; font-weight: bold; color: #cc0000; }
        .edit-mode {
            position: relative;
            padding: 2px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }
        .edit-mode input {
            width: calc(100% - 8px);
            margin-bottom: 2px;
            padding: 2px;
            box-sizing: border-box;
        }
        .edit-mode .cell-buttons {
            display: flex;
            justify-content: space-around;
            margin-top: 2px;
        }
        .edit-mode .cell-buttons button {
            padding: 3px 5px;
            font-size: 0.7em;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            white-space: nowrap;
        }
        .edit-mode .cell-buttons button.btn-temp { background-color: #ffc107; }
        .edit-mode .cell-buttons button.btn-cancel { background-color: #dc3545; }
        .name-entry { display: block; margin-top: 2px; margin-bottom: 2px; }

        /* 인쇄 모드 */
        @media print {
            body {
                background-color: white;
                margin: 0;
                padding: 0;
            }
            .controls {
                display: none; /* 버튼 영역 숨김 */
            }
            #scheduleContainer {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            table {
                width: 100%;
                font-size: 0.6em;
                border: 1px solid #000;
                transform: scale(0.9);  /* 표 크기 축소 */
                transform-origin: top left;
            }
            th, td {
                padding: 2px;
                height: auto;
            }
        }

        @media screen and (max-width: 768px) {
            .controls { flex-direction: column; align-items: stretch; }
            .controls input[type="number"],
            .controls select { width: 100%; }
            .controls label { text-align: left; margin-bottom: 0; }
            .controls button, .controls a.button-link { width: 100%; box-sizing: border-box; margin: 5px 0; }
            #scheduleContainer { padding: 5px; }
            table { font-size: 0.7em; }
            th, td { padding: 4px; }
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="yearInput">년도:</label>
        <input type="number" id="yearInput" value="2025">
        <label for="monthInput">월:</label>
        <input type="number" id="monthInput" value="9">
        
        <input type="radio" id="option1" name="displayOption" value="1" checked>
        <label for="option1">1일 ~ 15일</label>
        <input type="radio" id="option2" name="displayOption" value="2">
        <label for="option2">16일 ~ 말일</label>
        
        <button onclick="generateSchedule()">생성</button>
        <button onclick="printPage()">인쇄</button>
        <a href="https://waryong2025.github.io/timeman/" class="button-link" target="_blank">07번 배차표</a>
        <a href="https://waryong2025.github.io/townbus/" class="button-link" target="_blank">08번배차표</a>
    </div>
    <div id="scheduleContainer">
        <table>
            <caption id="tableCaption">종로 07번 2025년 9월 1일 ~ 15일까지 근무현황표</caption>
            <thead>
                <tr>
                    <th>월일</th>
                    <th>요일</th>
                    <th>3613</th>
                    <th>5536호</th>
                    <th>5537</th>
                    <th>3612</th>
                    <th>5518</th>
                    <th>기 타</th>
                </tr>
            </thead>
            <tbody id="scheduleBody"></tbody>
        </table>
    </div>
    <script>
        let fixedScheduleData = JSON.parse(localStorage.getItem('jongro07FixedSchedule')) || {};
        let scheduleData = {};
        
        const getDayName = (dayIndex) => ['일','월','화','수','목','금','토'][dayIndex];
        const getLastDayOfMonth = (year, month) => new Date(year, month, 0).getDate();

        const isPublicHoliday = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}`;
            const holidays2025 = new Set([
                "2025-01-01","2025-01-28","2025-01-29","2025-01-30",
                "2025-03-01","2025-05-05","2025-06-02","2025-06-06",
                "2025-08-15","2025-10-03","2025-10-06","2025-10-09",
                "2025-12-25"
            ]);
            return holidays2025.has(formattedDate);
        };

        const renderCellContent = (namesArray) => {
            if (!namesArray || (namesArray[0] === '' && namesArray[1] === '')) return '';
            return namesArray.filter(name => name).map(name => `<span class="name-entry">${name}</span>`).join('<br>');
        };

        function editCell(cellElement, colId, dateString) {
            if (cellElement.classList.contains('edit-mode')) return;
            const currentNames = (scheduleData[dateString] && scheduleData[dateString][colId]) || 
                                 (fixedScheduleData[dateString] && fixedScheduleData[dateString][colId]) || ['', ''];
            cellElement.dataset.colId = colId;
            cellElement.dataset.dateString = dateString;
            cellElement.classList.add('edit-mode');
            cellElement.innerHTML = `
                <input type="text" class="morning-input" value="${currentNames[0] || ''}" placeholder="오전 명단">
                <input type="text" class="afternoon-input" value="${currentNames[1] || ''}" placeholder="오후 명단">
                <div class="cell-buttons">
                    <button class="btn-fixed" onclick="saveFixedCell(this.parentNode.parentNode)">고정</button>
                    <button class="btn-temp" onclick="saveTempCell(this.parentNode.parentNode)">임시</button>
                    <button class="btn-cancel" onclick="resetCell(this.parentNode.parentNode)">초기화</button>
                </div>`;
        }

        function getNamesFromInput(cellElement) {
            const morningInput = cellElement.querySelector('.morning-input');
            const afternoonInput = cellElement.querySelector('.afternoon-input');
            return [morningInput.value.trim(), afternoonInput.value.trim()];
        }

        function saveFixedCell(cellElement) {
            const colId = cellElement.dataset.colId, dateString = cellElement.dataset.dateString;
            const newNames = getNamesFromInput(cellElement);
            if (!fixedScheduleData[dateString]) fixedScheduleData[dateString] = {};
            fixedScheduleData[dateString][colId] = newNames;
            localStorage.setItem('jongro07FixedSchedule', JSON.stringify(fixedScheduleData));
            if (!scheduleData[dateString]) scheduleData[dateString] = {};
            scheduleData[dateString][colId] = newNames;
            cellElement.classList.remove('edit-mode');
            cellElement.innerHTML = renderCellContent(newNames);
        }

        function saveTempCell(cellElement) {
            const colId = cellElement.dataset.colId, dateString = cellElement.dataset.dateString;
            const newNames = getNamesFromInput(cellElement);
            if (!scheduleData[dateString]) scheduleData[dateString] = {};
            scheduleData[dateString][colId] = newNames;
            cellElement.classList.remove('edit-mode');
            cellElement.innerHTML = renderCellContent(newNames);
        }

        function resetCell(cellElement) {
            const colId = cellElement.dataset.colId, dateString = cellElement.dataset.dateString;
            if (fixedScheduleData[dateString] && fixedScheduleData[dateString][colId]) delete fixedScheduleData[dateString][colId];
            localStorage.setItem('jongro07FixedSchedule', JSON.stringify(fixedScheduleData));
            generateSchedule();
        }

        function generateSchedule() {
            const year = parseInt(document.getElementById('yearInput').value);
            const month = parseInt(document.getElementById('monthInput').value);
            const selectedOption = document.querySelector('input[name="displayOption"]:checked').value;
            const scheduleBody = document.getElementById('scheduleBody');
            const tableCaption = document.getElementById('tableCaption');
            scheduleData = {};
            let startDate, endDate;
            if (selectedOption === '1') {
                startDate = new Date(year, month - 1, 1);
                endDate = new Date(year, month - 1, 15);
            } else {
                startDate = new Date(year, month - 1, 16);
                endDate = new Date(year, month - 1, getLastDayOfMonth(year, month));
            }
            startDate.setHours(0,0,0,0); endDate.setHours(0,0,0,0);
            tableCaption.textContent = `종로 07번 ${year}년 ${month}월 ${startDate.getDate()}일 ~ ${endDate.getDate()}일까지 근무현황표`;
            scheduleBody.innerHTML = '';
            const baseDate = new Date(2025, 8, 1); baseDate.setHours(0,0,0,0);
            let currentDate = new Date(startDate);
            while (currentDate.getTime() <= endDate.getTime()) {
                const day = currentDate.getDate(), dayOfWeek = currentDate.getDay(), dayName = getDayName(dayOfWeek);
                const isHoliday = isPublicHoliday(currentDate);
                const dateString = currentDate.toISOString().slice(0, 10);
                let cellsContent = {'3613':['',''],'5536호':['',''],'5537':['',''],'3612':['',''],'5518':['',''],'기 타':['','']};
                if (!(dayOfWeek===0 || isHoliday)) {
                    let firstMonday = new Date(currentDate), daysToSubtract = (firstMonday.getDay()===0)?6:firstMonday.getDay()-1;
                    firstMonday.setDate(firstMonday.getDate()-daysToSubtract); firstMonday.setHours(0,0,0,0);
                    const diffTime = firstMonday.getTime()-baseDate.getTime();
                    let weeksPassed = Math.floor(diffTime/(1000*60*60*24*7));
                    let initial3613=['이미휴','강명희'], initial5537=['이기용','정형택'], initial5536=['최창희','송명석'];
                    if (weeksPassed%2!==0){initial3613.reverse();initial5537.reverse();initial5536.reverse();}
                    cellsContent['3613']=initial3613; cellsContent['5536호']=initial5536;
                    if (dayOfWeek===6){cellsContent['5537']=['오부장','정형택'];} else {cellsContent['5537']=initial5537;}
                    cellsContent['5518']=(dayOfWeek===6)?['김영환','']:['','권과장'];
                }
                if (fixedScheduleData[dateString]) Object.assign(cellsContent,fixedScheduleData[dateString]);
                scheduleData[dateString]=cellsContent;
                let rowClass=''; if(dayOfWeek===0)rowClass='sunday'; else if(dayOfWeek===6)rowClass='saturday'; else if(isHoliday)rowClass='holiday';
                const row = `
                    <tr class="${rowClass}">
                        <td>${day}</td>
                        <td>${dayName}</td>
                        <td onclick="editCell(this, '3613', '${dateString}')">${renderCellContent(cellsContent['3613'])}</td>
                        <td onclick="editCell(this, '5536호', '${dateString}')">${renderCellContent(cellsContent['5536호'])}</td>
                        <td onclick="editCell(this, '5537', '${dateString}')">${renderCellContent(cellsContent['5537'])}</td>
                        <td onclick="editCell(this, '3612', '${dateString}')">${renderCellContent(cellsContent['3612'])}</td>
                        <td onclick="editCell(this, '5518', '${dateString}')">${renderCellContent(cellsContent['5518'])}</td>
                        <td onclick="editCell(this, '기 타', '${dateString}')">${renderCellContent(cellsContent['기 타'])}</td>
                    </tr>`;
                scheduleBody.insertAdjacentHTML('beforeend', row);
                currentDate.setDate(currentDate.getDate()+1);
            }
        }

        function printPage() {
            document.querySelectorAll('.edit-mode').forEach(cell => {
                const colId = cell.dataset.colId, dateString = cell.dataset.dateString;
                cell.classList.remove('edit-mode');
                if (scheduleData[dateString] && scheduleData[dateString][colId]) {
                    cell.innerHTML = renderCellContent(scheduleData[dateString][colId]);
                } else { cell.innerHTML = ''; }
            });
            window.print();
        }
        
        document.addEventListener('DOMContentLoaded', generateSchedule);
        window.onload = generateSchedule;
    </script>
</body>
</html>
